{% extends "layout.html" %}
{%block head%}
<link rel='stylesheet' type='text/css' href='static/css/dataTables.bootstrap.css'>
<link rel="stylesheet" type="text/css" href="static/css/jquery.dataTables.css">
<link rel="stylesheet" type="text/css" href="static/css/dataTables.colVis.css">
<link rel="stylesheet" type="text/css" href="static/css/dataTables.tableTools.css">

<script type='text/javascript' src='static/js/jquery-1.11.1.js'></script>
<script type='text/javascript' src='static/js/jquery.dataTables.js'></script>
<script type='text/javascript' src='static/js/dataTables.bootstrap.js'></script>
<script type='text/javascript' src='static/js/bootstrap-3.1.1.js'></script>
<script type='text/javascript' src='static/js/dataTables.colVis.js'></script>
<script type='text/javascript' src='static/js/dataTables.fixedColumns.js'></script>
<script type="text/javascript" src="static/js/dataTables.tableTools.js"></script>
<script src="static/highstock.js"></script>

<!--
When setting the name of posted variables, the name of "check_id", "comment_id" should not be assigned since I used the check_id to represent the checkboxes and comment_id to represent the comments
07/15/2014 ShinYeh
-->
<link rel="stylesheet" type="text/css" href="static/css/jquery-ui.css">
<script type='text/javascript' src='static/js/Chart.js'></script>
<script type='text/javascript' src='static/js/jquery-ui.js'></script>

{%endblock%}
{%block body%}

<script>
function openPopup() {
  var popup = window.open("", ""),
      table = document.getElementById("T_ETA_bugs_table");

  popup.document.write(table.outerHTML);
  popup.document.close();
  if (window.focus) 
    popup.focus();
}
</script>


<form action="" method=post>
<ul class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">

<script>
/* Create an array with the values of all the input boxes in a column, parsed as numbers */
$.fn.dataTable.ext.order['dom-text-numeric'] = function  ( settings, col )
{
    return this.api().column( col, {order:'index'} ).nodes().map( function ( td, i ) {
        //alert(i);
        //alert(td);
        //var spann = $("span", td)[0].innerText * 1
        var spann = $(td).find("span")[0].innerHTML * 1
        //alert($("span", td))
        //alert("??");
        return spann;
    } );
}
</script>


<script>
var fnBuild = function (){
    var CPDtools_table = $('#Table_CPDtools').DataTable({
        dom: 'lfrtip',
        //scrollY:        true,
        //scrollX:        true,
        paging:         false,
        autoWidth:      false,
        //"aoColumns": [ 
        //    {"bVisible":true},  
        //]
        //columnDefs: [ {
        //    "type": "dom-text-numeric",
        //    "targets": -1
        //} ]

        "columns": [
            null,
            null,
            null,
            null,
            null,
            null,
            null,
            null,
            { "orderDataType": "dom-text-numeric" }
        ]
    });
} 
</script>

<script>
$(document).ready(function(){
    fnBuild();
});
</script>

<script>
$(function(){
    $(".do_like_a").on('click', function(){   
        var like_a = $(this);   
        var id = like_a.attr("id"); //..id   
        //love.fadeOut(300); //....   
        $.ajax({   
            type:"GET",   
            url:"/Tool_Like",   
            data:"id="+id,   
            cache:false, //......   
            success:function(res){   
                if(res.res=="success"){
                    var ori = parseInt(document.getElementById("likes_"+id).innerHTML);
                    ori += 1;
                    document.getElementById("likes_"+id).innerHTML = ori;
                    document.getElementById("hidden_likes_"+id).innerHTML = ori;
                    var button = document.getElementById("img_div_"+id);
                    button.style.background="#777";
                }
                else if(res.res=="already"){
                    if (confirm('You have aleady liked it, undo like?')) {
                        $.ajax({
                            type:"GET",
                            url:"/Tool_Unlike",
                            data:"id="+id,
                            cache:false, 
                            success:function(res){
                                var ori = parseInt(document.getElementById("likes_"+id).innerHTML);
                                ori -= 1;
                                document.getElementById("likes_"+id).innerHTML = ori;
                                document.getElementById("hidden_likes_"+id).innerHTML = ori;
                                var button = document.getElementById("img_div_"+id);
                                button.style.background="#FFF";
                            }
                        });
                    } 
                }
                else{
                    alert(res.res);   
                }
            }   
        });   
    })
})
</script>

<script>
function query_tool_likes(id) {
    $.ajax({
        type:"GET",
        url:"/Tool_Like_Query",
        data:"id="+id,
        cache:false, //......
        success:function(res){
            if(res.res=="success"){
                document.getElementById("likes_"+id).innerHTML = res.data;
                document.getElementById("hidden_likes_"+id).innerHTML = res.data;
                if(res.liked==1){
                    var button = document.getElementById("img_div_"+id);
                    button.style.background="#777";
                }
            }
            else{
                alert(res.res);
            }
        }
    });
}
</script>

    <h1 class="page-header">
        <h2 class="sub-header">List of all tools</h2>
    </h1>
    {%if not tools==[]%}
    <table id="Table_CPDtools" class="display" cellspacing="0" width="100%">
        <thead>
            <tr>
                <th>Tool's Name</th>
                <th>Owner</th>
                <th>Team</th>
                <th>Keywords</th>
                <th>Maturity Level</th>
                <th>APP URL</th>
                <th>Wiki</th>
                <th>Edit</th>
                <th>Likes</th>
            </tr>
        </thead>
        <tbody>
        {% for tool in tools %}
            <tr>
                <td><a href='{{url_for("Show_Tool_Details")}}?name={{tool['tool_name']}}&id={{tool['tool_id']}}'>{{tool['tool_name']}}</a></td>
                <td>{{tool['authors']}}</td>
                <td>{{tool['team']}}</td>
                <td>{{tool['keywords']}}</td>
                <td>{{tool['maturity']}}</td>
                <td>{%if tool['url']%}<a href='{{tool['url']}}' class="btn btn-info"  target="_blank">Launch</a>{%endif%}</td>
                <td>{%if tool['wiki']%}<a href='{{tool['wiki']}}' class="btn btn-success"  target="_blank">Open</a>{%endif%}</td>
                <td><a href='{{url_for("Edit_Tool_Details")}}?name={{tool['tool_name']}}&id={{tool['tool_id']}}' class="btn btn-danger">Edit</a></td>
                <td><div style="display:none;" id='hidden_likes_{{tool['tool_id']}}'></div><div class="div_same_line" id="{{tool['tool_id']}}" ><div class="btn btn-default" id="img_div_{{tool['tool_id']}}"><a class='do_like_a' id="{{tool['tool_id']}}"><img src="static/images/like.svg" width="30px" height="20px" /></a></div><span class="badge" id='likes_{{tool['tool_id']}}'>0</span></div></td>
                <script>
                    query_tool_likes({{tool['tool_id']}})
                </script>
                <style>
                    #img_div a {
                        display: inline-block;
                        position: relative;
                        line-height: 0;
                        float: left;
                    }
                    #img_div img {
                    }
                    #img_div span {
                        position: absolute;
                        top: 5px;
                    }
                </style>
                <style>
                    .div_same_line {
                        overflow: hidden;
                        white-space: nowrap;
                    }
                </style>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    {%else%}
    N/A
    {%endif%}
    <br>

</ul>
</form>
{% endblock %}
